### 병렬 스트림 효과적으로 사용하기

- 확신이 서지 않는다면 측정하라.
    - 병렬 스트림이 항상 순차 스트림 보다 빠른 것이 아니다. 적절한 벤치 마크로 직접 성능을 측정하는 것이 바람직하다.


- 박싱을 주의하라.
    - 자바8에서는 박싱 동작을 피할 수 있도록 기본형 특화 스트림 (IntStream, LongStream, DoubleStream)을 제공한다.
      
    - 되도록이면 기본형 특화 스트림을 사용하는 것이 좋다.
    

- 순차 스트림보다 병렬 스트림에서 성능이 떨어지는 연산이 있다.
    - limit, findFirst 처럼 요소의 순서에 의존하는 연산을 병렬 스트림에서 수행하려면 비싼 비용을 치뤄야 한다.
    
    - findAny는 요소의 순서와 상관없이 연산하므로 findFirst 보다 성능이 더 좋다.
   
    - 스트림에 N개 요소가 있을 때 요소의 순서가 상관이없다면, 비정렬된 스트림에 limit를 호출하는 것이 더 효율적이다.
  
  
- 스트림에서 수행하는 전체 파이프라인 연산 비용을 고려하라.
    - 처리해야할 요소 수가 N이고 하나의 요소를 처리하는데 드는 비용을 Q라고 한다면 전체 스트림 파이프라인 처리 비용은 Q * N 이다.
      
    - Q가 높아진다는 것은 병렬 스트림으로 성능을 개선할 수 있는 가능성이 있음을 의미한다.

   
- 소량의 데이터에서 병렬 스트림이 도움 되지 않는다. 소량의 데이터를 처리하는 상황에서는 병렬화 과정에서는 생기는 부가 비용을 상쇄할 수 있을 만큼의 이득을 얻지 못한다.


- 스트림을 구성하는 자료구조가 적절한지 확인하라. ArrayList를 LinkedList보다 효율적으로 분할할 수 있다. LinkedList를 분할하려면 모든 요소를 탐색해야 한다.
    - range 팩토리 메서드로 만든 기본형 스트림도 쉽게 분해 가능하다.
      
    - 커스텀 Spliterator를 구현해서 분해 과정을 완벽하게 제어할 수 있다.
    
    
- 스트림의 특성과 파이프라인의 중간 연산이 스트림의 특성을 어떻게 바꾸는지에 따라 분해 과정의 성능이 달라 질 수 있다.
    - SIZED 스트림은 정확히 같은 크기의 두 스트림으로 분할할 수 있으므로 효과적으로 스트림을 병렬 처리할 수 있다.
      
    - 반면 필터 연산이 있으면 스트림의 길이를 예측할 수 없으므로 효과적으로 스트림을 병렬 처리할 수 있을지 알 수 없게 된다.


<br> 

|소스|분해성|
|------|---|
|ArrayList|훌륭함|
|LinkedList|나쁨|
|IntStream.range|훌륭함|
|Stream.range|나쁨|
|HashSet|좋음|
|TreeSet|좋음|
    
    
